!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.library=e()}(this,function(){"use strict";var t=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=["[CattleBridge]["+t.toUpperCase()+"]\t",e].concat(r);switch(t){case"throw":throw new Error(o[0]+e);case"info":console.info.apply(console,o);break;case"warn":console.warn.apply(console,o);break;case"error":console.error.apply(console,o);break;case"log":default:console.log.apply(console,o)}};function e(t,e){return e.reduce(function(t,e){return r=e,"[object Function]"==Object.prototype.toString.call(r)?e(t):e;var r},t)}function r(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce(function(t,e){return void 0===e||null===e?t:(Array.isArray(e)?t.push.apply(t,e):t.push(e),t)},[])}function n(t){return"[object Function]"==Object.prototype.toString.call(t)}function o(t,e,r){return n(t)?t.call(e,r):t}t.throw=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.apply(void 0,["throw",e].concat(r))},t.error=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.apply(void 0,["error",e].concat(r))},t.log=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.apply(void 0,["log",e].concat(r))},t.info=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.apply(void 0,["info",e].concat(r))},t.warn=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.apply(void 0,["warn",e].concat(r))};var i=function(o,i,a,c,s,l,u){var f=o.data,p=void 0,h=n(s)?s(function(t){p=t},f,o,a):s||o,d=e(f,r(c||void 0,a.trim||void 0));if(void 0!==p){var v={data:d,stat:h};p?(n(l)&&l(v),this.debug&&t("info","✔ 接口正常\n","状态: ",v.stat,"\n","数据: ",v.data)):(n(u)&&u(v),this.debug&&t("warn","💔 接口错误\n","数据: ",v.data,"\n","状态: ",v.stat))}else this.debug&&t("warn","😑你没有指定`stater()`返回result字段，回调不会被执行")};function a(t){return"[object Function]"==Object.prototype.toString.call(t)}return function(){function n(e){this.filters=e.filters,this.debug=!!e.debug,this.stater=e.stater,this.requester=e.requester,this.gtrim=e.gtrim,this.gchop=e.gchop,this.filters instanceof Object||t("throw","❌ Invalid Options: filters list"),this.filters||t("throw","❌ Invalid Options: filters list are expected to be an object"),a(this.stater)||t("throw","❌ Invalid Options: stater is expected to be a Function")}return n.prototype.fetch=function(n,c){var s=this;if(!(n in this.filters))return t("throw","❌ Invalid param `name`: no matched filter in filter list."),!1;var l=this.filters[n];return this.debug&&t("info","⌛ [发起请求] 项目名 "+n+"\n","输入参数:",c),a(l.handler)?new Promise(function(t,e){return l.handler(t,e,n,c)}):new Promise(function(n,a){var u=function(t,n,i){for(var a={},c=0,s=["url","method"];c<s.length;c++){var l=s[c];t.hasOwnProperty(l)&&(a[l]=t[l])}t.request instanceof Object&&Object.assign(a,o(t.request,t,n));for(var u=0,f=Object.keys(a);u<f.length;u++)a[l=f[u]]=o(a[l],t,n);return a.hasOwnProperty("data")||(a.data=e(n,r(t.chop?t.chop:void 0,i||void 0))),a}.call(s,l,c,s.gchop);s.requester(u).then(function(e){s.debug&&t("info","🌐 请求正常"),i.call(s,e,void 0,l,s.gtrim,s.stater,n,a)},function(e){s.debug&&t("info","🌐 请求错误\n","error: ",e),i.call(s,e.response,e,l,s.gtrim,s.stater,n,a)})})},n}()});
